<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>二进制高精度，ACMer 必知必会（不是）的算法 | Axiomofchoice&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <link rel="alternate" type="application/rss+xml" href="https://axiomofchoice-hjt.github.io/rss.xml" title="Axiomofchoice&#39;s Blog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://axiomofchoice-hjt.github.io/feed.atom" title="Axiomofchoice&#39;s Blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://axiomofchoice-hjt.github.io/feed.json" title="Axiomofchoice&#39;s Blog JSON Feed">
    <meta name="description" content="二进制大数">
    
    <link rel="preload" href="/assets/css/0.styles.11ff477d.css" as="style"><link rel="preload" href="/assets/js/app.c830a37c.js" as="script"><link rel="preload" href="/assets/js/3.c108dafd.js" as="script"><link rel="preload" href="/assets/js/2.cbe4f724.js" as="script"><link rel="preload" href="/assets/js/61.84917472.js" as="script"><link rel="prefetch" href="/assets/js/1.4eed1e25.js"><link rel="prefetch" href="/assets/js/10.ad773e8f.js"><link rel="prefetch" href="/assets/js/11.4e1d84b8.js"><link rel="prefetch" href="/assets/js/12.02b1bea3.js"><link rel="prefetch" href="/assets/js/13.12adc280.js"><link rel="prefetch" href="/assets/js/14.15f0d813.js"><link rel="prefetch" href="/assets/js/15.a831d227.js"><link rel="prefetch" href="/assets/js/16.72fe92b5.js"><link rel="prefetch" href="/assets/js/17.535820cf.js"><link rel="prefetch" href="/assets/js/18.b38c4ff1.js"><link rel="prefetch" href="/assets/js/19.9632b598.js"><link rel="prefetch" href="/assets/js/20.35d05648.js"><link rel="prefetch" href="/assets/js/21.1e34ae27.js"><link rel="prefetch" href="/assets/js/22.1799a80b.js"><link rel="prefetch" href="/assets/js/23.e07d6491.js"><link rel="prefetch" href="/assets/js/24.070eb6bf.js"><link rel="prefetch" href="/assets/js/25.395d1e9d.js"><link rel="prefetch" href="/assets/js/26.b1c5445f.js"><link rel="prefetch" href="/assets/js/27.47c01f51.js"><link rel="prefetch" href="/assets/js/28.fa5a3cdd.js"><link rel="prefetch" href="/assets/js/29.cad7b258.js"><link rel="prefetch" href="/assets/js/30.779191c3.js"><link rel="prefetch" href="/assets/js/31.7a7310e1.js"><link rel="prefetch" href="/assets/js/32.aac2b881.js"><link rel="prefetch" href="/assets/js/33.c996d036.js"><link rel="prefetch" href="/assets/js/34.7851e4e7.js"><link rel="prefetch" href="/assets/js/35.2bfa0d75.js"><link rel="prefetch" href="/assets/js/36.443d3b47.js"><link rel="prefetch" href="/assets/js/37.9288c5bc.js"><link rel="prefetch" href="/assets/js/38.ffa52f87.js"><link rel="prefetch" href="/assets/js/39.e6ca3fa7.js"><link rel="prefetch" href="/assets/js/4.4137d779.js"><link rel="prefetch" href="/assets/js/40.d83a3b53.js"><link rel="prefetch" href="/assets/js/41.2a09987c.js"><link rel="prefetch" href="/assets/js/42.f2f9dfea.js"><link rel="prefetch" href="/assets/js/43.a0ccd87c.js"><link rel="prefetch" href="/assets/js/44.1416c0a5.js"><link rel="prefetch" href="/assets/js/45.276bc4e6.js"><link rel="prefetch" href="/assets/js/46.db59f829.js"><link rel="prefetch" href="/assets/js/47.8bcdb596.js"><link rel="prefetch" href="/assets/js/48.bda901d1.js"><link rel="prefetch" href="/assets/js/49.a9a3d4ed.js"><link rel="prefetch" href="/assets/js/5.aa84404a.js"><link rel="prefetch" href="/assets/js/50.42a66987.js"><link rel="prefetch" href="/assets/js/51.dccced3e.js"><link rel="prefetch" href="/assets/js/52.a6a62d18.js"><link rel="prefetch" href="/assets/js/53.b5106fda.js"><link rel="prefetch" href="/assets/js/54.d9f4168e.js"><link rel="prefetch" href="/assets/js/55.0e6d9315.js"><link rel="prefetch" href="/assets/js/56.eae7ad00.js"><link rel="prefetch" href="/assets/js/57.a38819df.js"><link rel="prefetch" href="/assets/js/58.00a12678.js"><link rel="prefetch" href="/assets/js/59.84206ee6.js"><link rel="prefetch" href="/assets/js/6.e2c4f08c.js"><link rel="prefetch" href="/assets/js/60.4a14f707.js"><link rel="prefetch" href="/assets/js/62.d555ca6f.js"><link rel="prefetch" href="/assets/js/63.c7f1744a.js"><link rel="prefetch" href="/assets/js/64.bc74015f.js"><link rel="prefetch" href="/assets/js/65.4bdca311.js"><link rel="prefetch" href="/assets/js/66.68a2c4da.js"><link rel="prefetch" href="/assets/js/67.9907beb9.js"><link rel="prefetch" href="/assets/js/68.f760fdcd.js"><link rel="prefetch" href="/assets/js/69.f721a467.js"><link rel="prefetch" href="/assets/js/70.4469012d.js"><link rel="prefetch" href="/assets/js/71.0daeb317.js"><link rel="prefetch" href="/assets/js/72.054e2f68.js"><link rel="prefetch" href="/assets/js/73.4af2cbbe.js"><link rel="prefetch" href="/assets/js/74.6cad158c.js"><link rel="prefetch" href="/assets/js/75.39836f29.js"><link rel="prefetch" href="/assets/js/76.1cc6099c.js"><link rel="prefetch" href="/assets/js/77.dbec5fa5.js"><link rel="prefetch" href="/assets/js/78.bf7dfa53.js"><link rel="prefetch" href="/assets/js/79.3f18ec7e.js"><link rel="prefetch" href="/assets/js/80.51777c4a.js"><link rel="prefetch" href="/assets/js/9.dcb46077.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2c829e14.js">
    <link rel="stylesheet" href="/assets/css/0.styles.11ff477d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="Axiomofchoice's Blog" class="logo"> <span class="site-name can-hide">Axiomofchoice's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/pages/62c303/" class="nav-link">Blockchallenge</a></div> <a href="https://github.com/axiomofchoice-hjt/blogpages" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/favicon.ico"> <div class="blogger-info"><h3>Axiomofchoice</h3> <span>前 ACMer</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/pages/62c303/" class="nav-link">Blockchallenge</a></div> <a href="https://github.com/axiomofchoice-hjt/blogpages" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>高性能计算</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c1e151/" class="sidebar-link">浮点数误差入门</a></li><li><a href="/pages/85c4ed/" class="sidebar-link">集合求并的极致优化</a></li><li><a href="/pages/86fdbe/" class="sidebar-link">xbyak 汇编开发姿势</a></li><li><a href="/pages/1abfb8/" class="sidebar-link">如何做好 benchmark</a></li><li><a href="/pages/f2fc10/" class="sidebar-link">更自由的 perf 采样实践</a></li><li><a href="/pages/62c8f3/" class="sidebar-link">测量多线程每个线程的运行时间</a></li><li><a href="/pages/22df72/" class="sidebar-link">用户态线程同步</a></li><li><a href="/pages/d787b3/" class="sidebar-link">GEMM 接口</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/51f3ee/" class="sidebar-link">排序网络</a></li><li><a href="/pages/5b222d/" class="sidebar-link">博客搭建过程记录</a></li><li><a href="/pages/aca146/" class="sidebar-link">思想实验：让 Python 拥有 C 的性能</a></li><li><a href="/pages/2ef606/" class="sidebar-link">原地归并排序</a></li><li><a href="/pages/04ae8d/" class="sidebar-link">用汇编分析一下各种交换方法的性能</a></li><li><a href="/pages/22ee97/" class="sidebar-link">随机数生成问题 离散</a></li><li><a href="/pages/a651e2/" class="sidebar-link">随机数生成问题 连续</a></li><li><a href="/pages/dec161/" class="sidebar-link">如何写C++项目</a></li><li><a href="/pages/0fc19d/" class="sidebar-link">有没有计算时间复杂度的算法</a></li><li><a href="/pages/342a8d/" class="sidebar-link">理想的并行排序算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>算法竞赛</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/253550/" class="sidebar-link">Codeforces 1305 题解 (A-G)</a></li><li><a href="/pages/da7744/" class="sidebar-link">猫树的简单介绍</a></li><li><a href="/pages/d6b786/" class="sidebar-link">不平等博弈的 Q &amp; A</a></li><li><a href="/pages/1085fa/" class="sidebar-link">C++ STL 容器重要概念</a></li><li><a href="/pages/690153/" class="sidebar-link">有个表叫杨表</a></li><li><a href="/pages/e6708e/" class="sidebar-link">ACM 板子</a></li><li><a href="/pages/d8504e/" aria-current="page" class="active sidebar-link">二进制高精度，ACMer 必知必会（不是）的算法</a></li><li><a href="/pages/5d5a89/" class="sidebar-link">卡常：关于对常量取模的优化</a></li><li><a href="/pages/220100/" class="sidebar-link">球盒模型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数学</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/552367/" class="sidebar-link">集合的势</a></li><li><a href="/pages/f18b37/" class="sidebar-link">旋转60度后与自身重合的函数</a></li><li><a href="/pages/e3bbe6/" class="sidebar-link">初等数学问题的整理（一）</a></li><li><a href="/pages/72b0a9/" class="sidebar-link">初等数学问题的整理（二）</a></li><li><a href="/pages/1b2639/" class="sidebar-link">初等数学问题的整理（三）</a></li><li><a href="/pages/f5428f/" class="sidebar-link">初等数学问题的整理（四）</a></li><li><a href="/pages/73ab29/" class="sidebar-link">扑克牌魔术</a></li><li><a href="/pages/5c59de/" class="sidebar-link">翻硬币与旋转棋盘问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>杂谈</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/1919bb/" class="sidebar-link">关于博主</a></li><li><a href="/pages/228fff/" class="sidebar-link">今日瞎想</a></li><li><a href="/pages/9f1388/" class="sidebar-link">大学求职经历</a></li><li><a href="/pages/451424/" class="sidebar-link">HDU ACM 从入门到入坟</a></li><li><a href="/pages/f7352c/" class="sidebar-link">大学阶段回顾和总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>游戏</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/62c303/" class="sidebar-link">游戏：blockchallenge</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E6%89%80%E6%9C%89%E6%96%87%E7%AB%A0" title="分类" data-v-06225672>所有文章</a></li><li data-v-06225672><a href="/categories/?category=%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B" title="分类" data-v-06225672>算法竞赛</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/axiomofchoice-hjt" target="_blank" title="作者" class="beLink" data-v-06225672>Axiomofchoice</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-11-05</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><!----> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">二进制高精度，ACMer 必知必会（不是）的算法<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>上板子：<a href="https://github.com/axiomofchoice-hjt/ACM-axiomofchoice/blob/master/BigInt.cpp" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>先说几句废话。</p> <p>众所周知，遇到高精度题，（有的人赛后对线出题人），有的人使用 Java / Python，有的人直接高精度板子开冲。Java 的缺点是学习成本高、代码写起来繁琐，而 Python 的缺点是其运行速度（其实 Pypy 挺快的）。由于种种原因，我们仍然不能抛弃 C++ 高精度板子。</p> <p>在网上的高精度板子大致分为几个流派：存储结构有不压位的、压 3 位的、压 9 位的，乘法的时候有暴力、FFT、NTT。曾经的我以为乘法暴力就完事，（事实上正经比赛暴力真的完事），有一天练习时我被卡 TLE 了，最后用了 Java 才解决问题。痛定思痛，我决定打造一个 ACM 界最牛逼（并不）的高精度板子。</p> <p>我偶然发现，Java 的大数类 (BigInteger) 是 Java 实现的。既然如此，我把这部分代码翻译到 C++ 不就变成高精度板子了吗？</p> <hr> <p>Java 大数类的实现有几个很不一样的地方。</p> <p>第一个是二进制存放数据，每个比特都没有浪费。具体实现是用 int 数组（Java 没有无符号数）存放。好处很明显，十进制高精度运算的时候，必然伴随着大量整除运算和取模运算，这会成为性能瓶颈，二进制就没这问题。但是缺点是输入输出时需要二进制和十进制之间进行转换。我读了一下 Java 源码，十进制转二进制的复杂度是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span> ，二进制转十进制没读懂，估计也是这个复杂度。实测十万位的转换已经需要几秒时间了。</p> <p>第二是乘法用了朴素算法 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span> 、Karatsuba <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mrow><msub><mi>log</mi><mn>2</mn></msub><mn>3</mn></mrow></msup><mo>)</mo><mo>≈</mo><mi>O</mi><mo>(</mo><msup><mi>n</mi><mrow><mn>1</mn><mi mathvariant="normal">.</mi><mn>5</mn><mn>8</mn></mrow></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^{\log_2 3})\approx O(n^{1.58})</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.849108em;"></span><span class="strut bottom" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="vlist"><span style="top:0.24444em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">3</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">≈</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mord mathrm">8</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span> 、Toom Cook-3 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mrow><msub><mi>log</mi><mn>3</mn></msub><mn>5</mn></mrow></msup><mo>)</mo><mo>≈</mo><mi>O</mi><mo>(</mo><msup><mi>n</mi><mrow><mn>1</mn><mi mathvariant="normal">.</mi><mn>4</mn><mn>6</mn></mrow></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^{\log_3 5})\approx O(n^{1.46})</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.849108em;"></span><span class="strut bottom" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="vlist"><span style="top:0.24444em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathrm">5</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mrel">≈</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span><span class="mord mathrm">.</span><span class="mord mathrm">4</span><span class="mord mathrm">6</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span> 三种算法，看情况选择使用哪个。相比于 FFT / NTT，这几个算法的实现更加贴近二进制。复杂度虽然高，但是实际测试的时候常数极小，优势非常明显。</p> <p>因此二进制高精度适用的场景是，有大量乘法，但是输入输出的位数不能太大（二进制输入输出除外）。当然前提是允许贴板子，如果是真的比赛，一般情况下十进制高精就能过，二进制板子太长反而浪费时间。</p> <hr> <p>然后说一下实现细节。</p> <p>类似 Java，用 int 来保存符号（三个可能的值，-1, 1, 0 分别对应正数、负数、零），用 <code>vector&lt;unsigned&gt;</code> 来保存这个数的绝对值，类似原码的存储。（用 vector 是因为懒得写 delete，而且能加长；Java 源码是定长的）</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">big</span> <span class="token punctuation">{</span>
    <span class="token keyword">using</span> uint <span class="token operator">=</span> <span class="token keyword">unsigned</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> ull <span class="token operator">=</span> <span class="token keyword">uint64_t</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> vtr <span class="token operator">=</span> vector<span class="token operator">&lt;</span>uint<span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> sign<span class="token punctuation">;</span> <span class="token comment">// 1 表示正数，-1 表示负数，0 表示等于 0</span>
    vtr mag<span class="token punctuation">;</span> <span class="token comment">// 存放绝对值</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>首先是十进制字符串转换到二进制的问题。Java 的实现中，先估计存下这个数需要的 int 的个数，进行 mag 的一个空间申请。然后每 9 个十进制位一组（比如 s[9k .. 9k+8]），每次让 mag 乘以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">9</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 再加上 s[9k .. 9k+8]。</p> <p>Java 实现有更强的兼容性，我翻译时简化了很多，如下：（这个 Inplace 是原地操作的意思）</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">static</span> uint <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string 转换为 uint，略</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">mulInplace</span><span class="token punctuation">(</span>vtr <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> uint y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">{</span> <span class="token comment">// 高精度乘单精度，略</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addInplace</span><span class="token punctuation">(</span>vtr <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> uint y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 高精度加单精度，略</span>
<span class="token keyword">explicit</span> <span class="token function">big</span><span class="token punctuation">(</span>string val<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 用 string 构造</span>
    <span class="token keyword">const</span> uint len <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sign <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uint cursor <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uint groupLen <span class="token operator">=</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> cursor <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">9</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        string group <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> groupLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cursor <span class="token operator">+=</span> groupLen<span class="token punctuation">;</span>
        <span class="token function">mulInplace</span><span class="token punctuation">(</span>mag<span class="token punctuation">,</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addInplace</span><span class="token punctuation">(</span>mag<span class="token punctuation">,</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        groupLen <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mag<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> sign <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>二进制转换到十进制，源码有点复杂，我没绕清楚。但是可以把十进制转二进制反着来做，即先实现高精度对单精度的乘除和取模，然后每次除以 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">9</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> ，9 位 9 位地拿到十进制。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">static</span> uint <span class="token function">divModInplace</span><span class="token punctuation">(</span>vtr <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> uint m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 高精度整除单精度，返回余数，略</span>
string <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token comment">// 转换为 string</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sign <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
    string result<span class="token punctuation">;</span>
    vtr t <span class="token operator">=</span> mag<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        string k <span class="token operator">=</span> <span class="token function">to_string</span><span class="token punctuation">(</span><span class="token function">divModInplace</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> k <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">-</span> k<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token char">'0'</span><span class="token punctuation">)</span> <span class="token operator">+</span> k<span class="token punctuation">;</span>
        <span class="token function">reverse</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> k<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">+=</span> k<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sign <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> result <span class="token operator">+=</span> <span class="token char">'-'</span><span class="token punctuation">;</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>高精度加、减法，这很简单，直接略。</p> <p>最后是二进制高精度的精髓，即乘法。如果规模比较小，朴素乘法 (Grade-School Algorithm) 显然是首选，如下：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">static</span> vtr <span class="token function">mul</span><span class="token punctuation">(</span><span class="token keyword">const</span> vtr <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token keyword">const</span> vtr <span class="token operator">&amp;</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 高精度乘法 Grade-School Algorithm</span>
    vtr <span class="token function">z</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>uint i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        ull carry <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>uint j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            carry <span class="token operator">+=</span> <span class="token punctuation">(</span>ull<span class="token punctuation">)</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> y<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> z<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> carry<span class="token punctuation">;</span>
            carry <span class="token operator">&gt;&gt;=</span> <span class="token number">32</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        z<span class="token punctuation">[</span>i <span class="token operator">+</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> carry<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">adjust</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除前导 0</span>
    <span class="token keyword">return</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>卡拉苏巴算法 (Karatsuba Algorithm) 是一个分治算法，它每次将两个乘数 x, y 分成两个部分，高位和低位，然后进行一些计算。这个相关资料挺多，我不详细讲了。</p> <p>Java 的乘法还实现了 Toom Cook-3，但是卡拉苏巴已经够用，我就不翻译了。</p> <p>卡拉苏巴实现的时候，我设置为如果朴素算法规模不超过 512 就用朴素算法实现，否则分治。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addInplace</span><span class="token punctuation">(</span>vtr <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> vtr y<span class="token punctuation">,</span> <span class="token keyword">int</span> sign <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 高精度加、减高精度，sign 为 -1 表示减法，且必须满足 x &gt; y，略</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">shiftLeft32Inplace</span><span class="token punctuation">(</span>vtr <span class="token operator">&amp;</span>mag<span class="token punctuation">,</span> uint nInts<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 左移 32 * nInts 位，略</span>
<span class="token keyword">static</span> vtr <span class="token function">Karatsuba</span><span class="token punctuation">(</span><span class="token keyword">const</span> vtr <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token keyword">const</span> vtr <span class="token operator">&amp;</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 高精度乘法 Karatsuba Algorithm</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">512</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">mul</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    ull half <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    vtr <span class="token function">xl</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">min</span><span class="token punctuation">(</span>half<span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vtr <span class="token function">xh</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">min</span><span class="token punctuation">(</span>half<span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vtr <span class="token function">yl</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">min</span><span class="token punctuation">(</span>half<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vtr <span class="token function">yh</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">min</span><span class="token punctuation">(</span>half<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vtr p1 <span class="token operator">=</span> <span class="token function">Karatsuba</span><span class="token punctuation">(</span>xh<span class="token punctuation">,</span> yh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vtr p2 <span class="token operator">=</span> <span class="token function">Karatsuba</span><span class="token punctuation">(</span>xl<span class="token punctuation">,</span> yl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addInplace</span><span class="token punctuation">(</span>xh<span class="token punctuation">,</span> xl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">addInplace</span><span class="token punctuation">(</span>yh<span class="token punctuation">,</span> yl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vtr p3 <span class="token operator">=</span> <span class="token function">Karatsuba</span><span class="token punctuation">(</span>xh<span class="token punctuation">,</span> yh<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接下来计算答案 p1 = p1 * 2^(64h) + (p3 - p1 - p2) * 2^(32h) + p2</span>
    <span class="token function">addInplace</span><span class="token punctuation">(</span>p3<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">addInplace</span><span class="token punctuation">(</span>p3<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">shiftLeft32Inplace</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> half<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addInplace</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">shiftLeft32Inplace</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> half<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addInplace</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> p1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>什么，你还想要除法？（出门左转 Python）现在还没搞，如果实现起来比较简单的话我还会回来更新的。</p> <p>然后说一下效果，就那题（不说哪题了，丢人），十进制板子的朴素乘法和 FFT 都 TLE，Java 1913ms，二进制板子 356ms。（虽然我自带常数，别人直接莽都能过，但不影响二进制板子牛逼鸭）</p> <hr> <p>以上。</p></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/e6708e/" class="prev">ACM 板子</a></span> <span class="next"><a href="/pages/5d5a89/">卡常：关于对常量取模的优化</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:axiomofchoice@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="tencent://AddContact/?fromId=50&amp;fromSubId=1&amp;subcmd=all&amp;uin=1939696303" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href="https://github.com/axiomofchoice-hjt" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://axiomofchoice-hjt.github.io/rss.xml" title="RSS" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>Axiomofchoice | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c830a37c.js" defer></script><script src="/assets/js/3.c108dafd.js" defer></script><script src="/assets/js/2.cbe4f724.js" defer></script><script src="/assets/js/61.84917472.js" defer></script>
  </body>
</html>
